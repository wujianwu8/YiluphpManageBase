function autoTextarea(c,d,h){d=d||0;var a=!!document.getBoxObjectFor||"mozInnerScreenX" in window,b=!!window.opera&&!!window.opera.toString().indexOf("Opera"),e=function(k,l){c.addEventListener?c.addEventListener(k,l,false):c.attachEvent("on"+k,l)},f=c.currentStyle?function(k){var m=c.currentStyle[k];if(k==="height"&&m.search(/px/i)!==1){var l=c.getBoundingClientRect();return l.bottom-l.top-parseFloat(f("paddingTop"))-parseFloat(f("paddingBottom"))+"px"}return m}:function(k){return getComputedStyle(c,null)[k]},j=parseFloat(f("height"));c.style.resize="none";var g=function(){var n,k,m=0,l=c.style;if(c._length===c.value.length){return}c._length=c.value.length;if(!a&&!b){m=parseInt(f("paddingTop"))+parseInt(f("paddingBottom"))}n=document.body.scrollTop||document.documentElement.scrollTop;c.style.height=j+"px";if(c.scrollHeight>j){if(h&&c.scrollHeight>h){k=h-m;l.overflowY="auto"}else{k=c.scrollHeight-m;l.overflowY="hidden"}l.height=k+d+"px";n+=parseInt(l.height)-c.currHeight;document.body.scrollTop=n;document.documentElement.scrollTop=n;c.currHeight=parseInt(l.height)}};e("propertychange",g);e("input",g);e("focus",g);g()}function getCurrentHost(){var a=document.location.href;var b=a.split("//");var d=b[1].indexOf("/");var c=b[1].substring(0,d);return b[0]+"//"+c}function getUrlDirname(a){tmp=a.split("?");tmp=tmp[0];tmp=tmp.split("#");tmp=tmp[0];tmp=tmp.split("/");completeUrl=[];for(i=0;i<tmp.length-1;i++){completeUrl.push(tmp[i])}completeUrl=completeUrl.join("/");return completeUrl}function loading(a){if(a!==false){a=true}return $(document).dialog({type:"notice",dialogClass:"dialog_transparent",content:'<div class="loadEffect"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></div>',overlayShow:a})}function dialogShowUserInfo(b,a){$.get("/user/detail/"+b,function(c){$(document).dialog({titleText:getLang("details_of_user",{nickname:a}),content:c,buttonTextConfirm:getLang("close")})})}function changeUserStatus(c,b,a){$.ajax({type:"POST",url:"/user/change_user_status",data:{uid:c,status:a,dtype:"json"},dataType:"json",success:function(d){if(d.code==0){reloadPage()}else{$(document).dialog({type:"notice",position:"bottom",dialogClass:"dialog_warn",infoText:d.msg,autoClose:3000,overlayShow:false})}}})}function rsaEncryptData(a,c){var d=new JSEncrypt();d.setPublicKey(rsaPublicKey);for(var b in c){if(a[c[b]]!==undefined&&a[c[b]]!==null){a[c[b]]=d.encrypt(a[c[b]]);a[c[b]]=encodeURI(a[c[b]]).replace(/\+/g,"%2B")}}return a}function is_email(a){return a.match(/^[a-zA-Z0-9]+([-_.][a-zA-Z0-9]+)*@([a-zA-Z0-9]+[-.])+([a-z]{2,10})$/)}function is_password(a){return a.match(/^(?=.*[0-9].*)(?=.*[A-Z].*)(?=.*[a-z].*)(?=.*[\.\$!#@_-].*).{6,20}$/)}function is_key_string(a){return a.match(/^[a-zA-Z0-9_]+$/)}function ajaxPost(b,c,e,d){var a=loading(d);$.ajax({type:"post",dataType:"json",url:b,data:c,success:function(g,h,f){a.close();if(g.code==0){e(g)}else{$(document).dialog({type:"notice",position:"bottom",dialogClass:"dialog_warn",infoText:g.msg,autoClose:3000,overlayShow:false})}},error:function(f,h,g){a.close();$(document).dialog({type:"notice",position:"bottom",dialogClass:"dialog_red",infoText:h,autoClose:3000,overlayShow:false})}})}function getUrlParam(a){var b=new RegExp("(^|&)"+a+"=([^&]*)(&|$)");var c=window.location.search.substr(1).match(b);if(c!=null){return unescape(c[2])}return null}function getUrlParms(){var b=new Object();var f=location.search.substring(1);var e=f.split("&");for(var c=0;c<e.length;c++){var g=e[c].indexOf("=");if(g==-1){continue}var a=e[c].substring(0,g);var d=e[c].substring(g+1);b[a]=decodeURIComponent(d)}return b}function parseUrlParams(c){var b=new Object();var f=c.split("?");if(f.length<=1){return b}f=f[1].split("&");for(var d=0;d<f.length;d++){var g=f[d].indexOf("=");if(g==-1){continue}var a=f[d].substring(0,g);var e=f[d].substring(g+1);b[a]=unescape(e)}return b}function getStringLen(a){a=a.replace(/[^\x00-\xff]/g,"xx");return a.length}function checkUsername(b){var a={status:true,msg:"",type:"loginname",code:0};if(/^(\w)+(\.\w+)*@(\w)+((\.\w+)+)$/.test(b)){a.type="email";if(b.length<8){a.status=false;a.code=1;a.msg="email 地址太短，请检查正确性"}if(b.length>40){a.status=false;a.code=2;a.msg="email 地址长度不能超过40个字符"}}else{if(/^1[1-9]\d{9}$/.test(b)){a.type="mobile"}else{if(/^1[1-9]\d{9}$/.test(b)){a.status=false;a.code=3;a.msg="登录名不能为纯数字，手机号应为11位数字"}else{if(!/^[\w\u4E00-\u9FA5-\.]+$/.test(b)){a.status=false;a.code=4;a.msg="登录名只能包含数字、字母、下划线、中文、中划线和点"}else{if(getStringLen(b)<5){a.status=false;a.code=5;a.msg="登录名不能少于5位字符，一个中文算2位字符"}else{if(getStringLen(b)>30){a.status=false;a.code=6;a.msg="登录名不能多于30位字符，一个中文算2位字符"}}}}}}return a}function checkPassword(a){if(getStringLen(a)>20||getStringLen(a)<6){return getLang("password_too_simple")}else{if(is_password(a)){return true}else{return getLang("password_too_simple")}}}function getReturnUrl(){var a=getUrlParam("redirect_uri");if(!a){a=$.cookie("redirect_uri");if(a===null||a===""){if(document.referrer&&document.referrer.indexOf(document.domain)==0){a=document.referrer}else{a="/dashboard"}}}if(a===null||a===""){a="/dashboard"}return a}function jumpNow(a){if(a!=undefined){document.location.href=a}else{document.location.href=getReturnUrl()}}function getJsonLength(a){var c=0;for(var b in a){c++}return c}var isWeiXin=function(){var a=window.navigator.userAgent.toLowerCase();if(a.match(/MicroMessenger/i)=="micromessenger"){return true}else{return false}};function checkIdentityType(){var a=$("#identity").val();if(a.match(/[^\w\._\-@]+/)){a=a.replace(/[^\w\._\-@]+/,"");$("#identity").val(a)}if(a.match(/[^\d]+/)){console.info("not all number");if($("#existing-area-select").hasClass("show-area-select")){$("#existing-area-select").removeClass("show-area-select").addClass("hide-area-select")}}else{if(a.length>4){$("#existing-area-select").removeClass("hide-area-select").addClass("show-area-select")}}}var onShowWeixinQRCode=false;function checkWeixinQRLoginStatus(a){$.ajax({type:"post",dataType:"json",url:"/sign/wechat_check_qr_login"+(a==1?"/for_bind/1":""),success:function(c,d,b){if(onShowWeixinQRCode&&c.code!=4){if(c.code==30||c.code==31||c.code==32){$("#weixinQR").find("strong").show().text(getLang("binding_failed"));$(document).dialog({type:"notice",position:"bottom",dialogClass:"dialog_warn",infoText:c.msg,autoClose:5000,overlayShow:false})}else{$("#weixinQR").find("strong").show().text(c.msg)}}else{if(onShowWeixinQRCode&&c.code==4){$("#weixinQR").find("strong").hide()}}if(c.code==0){document.location.href="/sign/bind_account"}else{if(c.code==1||c.code==5){jumpNow()}else{if(c.code==33||c.code==34){onShowWeixinQRCode=false;reloadPage()}else{if(c.code==30||c.code==31||c.code==32){onShowWeixinQRCode=false}else{if(onShowWeixinQRCode){setTimeout(function(){checkWeixinQRLoginStatus(a)},1000)}}}}}},error:function(b,d,c){$("#weixinQR").find("strong").show().text(d)}})}function weixinLogin(a){if(a==1){url="/sign/wechat_login/for_bind/1"}else{url="/sign/wechat_login"}if(isWeiXin()){document.location.href=url}else{if(haveWeixinOpen){document.location.href=url+"?open=1"}else{$(document).dialog({titleShow:false,overlayClose:true,content:'<div id="weixinQR"><span><img src="" onload="checkWeixinQRLoginStatus('+(a==1?1:0)+')"><strong></strong></span><div class="text">'+getLang("sign_in_with_wechat_scanning_code")+"</div></div>",buttonTextConfirm:getLang("cancel"),onShow:function(){onShowWeixinQRCode=true;random=Math.random();random="h"+random;$("#weixinQR").find("img").attr("src","/sign/wechat_login_qr?rand="+random);$("#weixinQR").find("span").bind("click",function(b){onShowWeixinQRCode=true;$("#weixinQR").find("img").attr("src","/sign/wechat_login_qr?rand="+random);$("#weixinQR").find("strong").hide()})},onClosed:function(){onShowWeixinQRCode=false}})}}}function qqLogin(){window.open("/sign/qq_login","TencentLogin","width=450,height=410,menubar=0,scrollbars=1, resizable=1,status=1,titlebar=0,toolbar=0,location=1")}function changeLanguage(b){if(b=="selected"){return false}url=document.location.href;tmp=url.split("#");tmp2=tmp[0].split("?");args=getUrlParms();args.lang=b;params=[];for(var a in args){params.push(a+"="+args[a])}url=tmp2[0]+"?"+params.join("&");if(tmp.length>1){url+="#"+tmp[1]}document.location.href=url}function getLang(a,b){if(typeof language=="object"){if(typeof language[a]=="string"){a=language[a];if(typeof b=="object"){$.each(b,function(c,d){reg=new RegExp("\\{\\$"+c+"\\}","g");a=a.replace(reg,d)})}}}return a};